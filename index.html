<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>ðŸ›’ Home Â¡Lista para comprar</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>

<body class="container py-4">
    <h1>ðŸ›’ Â¡Lista para comprar</h1>

    <!-- BotÃ³n para crear nueva lista -->
    <div class="mb-3">
        <button class="btn btn-success" onclick="window.location.href='lista_form.html'">
            + Nueva Lista
        </button>
    </div>
    <h2>Listas Guardadas</h2>

    <ul id="listaListas" class="list-group my-4">
        <!-- Listas cargadas aquÃ­ -->
    </ul>

    <script>
        function cargarListas() {
            const listaListas = document.getElementById("listaListas");
            listaListas.innerHTML = "";

            const listasJSON = localStorage.getItem("listas"); // Busca la clave "listas"
            if (listasJSON) {
                const listas = JSON.parse(listasJSON);

                listas.forEach((lista, index) => {
                    const item = document.createElement("li");
                    item.className =
                        "list-group-item d-flex justify-content-between align-items-center";

                    item.innerHTML = `
                        <div>
                            <strong>${lista.nombre || "Sin Nombre"}</strong><br>
                            <small>${lista.dataHora}</small>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-primary me-2" onclick="verDetalles(${index})">Ver Detalles</button>
                            <button class="btn btn-sm btn-secondary me-2" onclick="duplicarLista(${index})">Duplicar</button>
                            <button class="btn btn-sm btn-warning me-2" onclick="editarLista(${index})">Editar</button>
                            <button class="btn btn-sm btn-danger" onclick="eliminarLista(${index})">Eliminar</button>
                        </div>
                    `;

                    listaListas.appendChild(item);
                });
            } else {
                listaListas.innerHTML =
                    '<li class="list-group-item">No se encontraron listas.</li>';
            }
        }

        function verDetalles(index) {
            window.location.href = `detalles_lista.html?index=${index}`;
        }

        function duplicarLista(index) {
            const listasJSON = localStorage.getItem("listas");
            if (listasJSON) {
                const listas = JSON.parse(listasJSON);
                const original = listas[index];
                if (original) {
                    const copia = { ...original };
                    copia.nombre = (original.nombre || "Sin Nombre") + " (Copia)";
                    // Fecha y hora formateada en zona horaria espaÃ±ola
                    copia.dataHora = new Date().toLocaleString("es-ES", {
                        timeZone: "Europe/Madrid",
                        hour: "2-digit",
                        minute: "2-digit",
                        day: "2-digit",
                        month: "2-digit",
                        year: "numeric",
                    });

                    listas.push(copia);
                    localStorage.setItem("listas", JSON.stringify(listas));
                    alert(`Lista duplicada como "${copia.nombre}"`);
                    cargarListas(); // Recargar
                }
            }
        }

        function editarLista(index) {
            window.location.href = `lista_form.html?index=${index}`;
        }

        function eliminarLista(index) {
            const confirmacion = confirm("Â¿EstÃ¡s seguro de que deseas eliminar esta lista?");
            if (confirmacion) {
                const listasJSON = localStorage.getItem("listas");
                if (listasJSON) {
                    const listas = JSON.parse(listasJSON);
                    listas.splice(index, 1); // Quitar lista del array
                    localStorage.setItem("listas", JSON.stringify(listas));
                    alert("Lista eliminada con Ã©xito.");
                    cargarListas(); // Recargar lista
                }
            }
        }

        cargarListas();
    </script>
</body>

</html>